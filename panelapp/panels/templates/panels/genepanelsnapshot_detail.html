{% extends "default.html" %}
{% load static %}
{% load staticfiles %}
{% load panel_helpers %}
{% block title %}{{ entity.label|capfirst }} ({{ panel.level4title.name }}){% endblock %}
{% block header %}
  <script src="{% static 'django_ajax/js/jquery.ajax.min.js' %}"></script>
  <script src="{% static 'django_ajax/js/jquery.ajax-plugin.min.js' %}"></script>
{% endblock %}

{% block content %}
<ol class="breadcrumb">
    <li>
        <a href="{% url 'panels:index' %}">Panels</a>
    </li>
    <li>
        <a href="{{ view.panel.panel.get_absolute_url }}">
            {{ view.panel.panel.name }}
        </a>
    </li>
    <li class="active">
        {{ entity.name }}
    </li>
</ol>

<div class="row">
    <div class="col-sm-2">
        <div id="genes_list" class="panel panel-default">
            {% include "panels/entity/evaluation_genes_list.html" %}
        </div>
        <div id="strs_list" class="panel panel-default">
            {% include "panels/entity/evaluation_strs_list.html" %}
        </div>
    </div>
    <div class="col-sm-10">
        <div id="gene_header">
            {% include "panels/entity/header.html" %}
        </div>
        <hr />
        <p class="lead">
            {% if entity.is_str %}
                GRCh37 Position (Chr:Position): {{ entity.position_37 }}<br />
                GRCh38 Position (Chr:Position): {{ entity.position_38 }}<br />
                Repeated Sequence: {{ entity.repeated_sequence }}<br />
                {% if entity.normal_range %}
                    Normal Range: {{ entity.normal_range.lower }}-{{ entity.normal_range.upper }}<br />
                {% endif %}
                {% if entity.prepathogenic_range %}
                    Pre-pathogenic Range: {{ entity.prepathogenic_range.lower }}-{{ entity.prepathogenic_range.upper }}<br />
                {% endif %}
                {% if entity.pathogenic_range %}
                    Pathogenic Range: {{ entity.pathogenic_range.lower }}-{{ entity.pathogenic_range.upper }}<br />
                {% endif %}
                <br />
            {% endif %}
            {{ entity.gene.gene_name }}<br />
            {% if entity.gene.ensembl_genes %}
                {% if entity.gene.ensembl_genes.GRch38.90  %}
                    EnsemblGeneIds (GRCh38):
                    <a href="http://www.ensembl.org/Homo_sapiens/Gene/Summary?db=core;g={{ entity.gene.ensembl_genes.GRch38.90.ensembl_id }}" target="_blank">{{ entity.gene.ensembl_genes.GRch38.90.ensembl_id }}</a>
                    <br />
                {% endif %}
                {% if entity.gene.ensembl_genes.GRch37.82 %}
                    EnsemblGeneIds (GRCh37):
                    <a href="http://Dec2016.archive.ensembl.org/Homo_sapiens/Gene/Summary?db=core;g={{ entity.gene.ensembl_genes.GRch37.82.ensembl_id }}" target="_blank">{{ entity.gene.ensembl_genes.GRch37.82.ensembl_id }}</a>
                    <br />
                {% endif %}
            {% endif %}
            {% if entity.gene.omim_gene|length > 0 %}
              <a href="http://omim.org/entry/{{ entity.gene.omim_gene.0 }}" target="_blank">OMIM: {{ entity.gene.omim_gene.0 }}</a>, <a href=" http://www.ebi.ac.uk/gene2phenotype/gene2phenotype-webcode/cgi-bin/handler.cgi?panel=ALL&search_term={{ entity.gene.gene_symbol }}" target="_blank">Gene2Phenotype</a><br />
            {% endif %}
            {% if entity.is_gene %}
            {% with shared_panels=sharing_panels %}
            {{ entity.gene.gene_symbol }} is in <a href="{% url 'panels:gene_detail' entity.gene.gene_symbol %}">{{ shared_panels|length }} panel{{ shared_panels|pluralize }}</a>
            {% endwith %}
            {% endif %}
        </p>

        <div data-module="tab-switcher" data-default-tab="evaluate">
            <ul class="nav nav-tabs" role="tablist">
                <li role="presentation" class="active">
                    <a href="#evaluate" aria-controls="evaluate" role="tab" data-toggle="tab">Reviews ({{ entity.number_of_evaluations }})</a>
                </li>
                <li role="presentation">
                    <a href="#details" aria-controls="details" role="tab" data-toggle="tab">Details</a>
                </li>
                <li role="presentation">
                    <a href="#history" aria-controls="history" role="tab" data-toggle="tab">History</a>
                </li>
                {% if request.user.is_authenticated and request.user.reviewer.is_GEL %}
                <li role="presentation">
                    <a href="#review" aria-controls="review" role="tab" data-toggle="tab">Review feedback</a>
                </li>
                {% endif %}
            </ul>

            <div class="tab-content">
                <div role="tabpanel" class="tab-pane active" id="evaluate">
                    {% include "panels/entity/evaluate.html" %}
                </div>
                <div role="tabpanel" class="tab-pane" id="details">
                    {% if entity_type == 'gene' %}
                        {% include "panels/genepanelentrysnapshot/details.html" %}
                    {% elif entity_type == 'str' %}
                        {% include "panels/strs/details.html" %}
                    {% endif %}
                </div>
                <div role="tabpanel" class="tab-pane" id="history">
                    {% include "panels/entity/history.html" %}
                </div>
                {% if request.user.is_authenticated and request.user.reviewer.is_GEL %}
                <div role="tabpanel" class="tab-pane" id="review">
                    {% include "panels/entity/review.html" %}
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block modals %}
  {% include "panels/modals/rating.html" %}
  {% include "panels/modals/mode_of_path.html" %}
  {% include "panels/modals/diagnostic.html" %}
  {% include "panels/modals/mode_of_inheritance.html" %}
{% endblock %}

{% block js %}
<script>
    window.GeneTags = [{% for tag in gene.tags.all %}{% if tag %}'{{ tag }}'{% if not forloop.last %},{% endif %}{% endif %}{% endfor %}];
</script>
{% endblock %}
